<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Smart Banking</title>
    <link rel="stylesheet" href="css/hdfc_style.css">
</head>

<body>
    <nav class="navbar">
        <div class="navbar-brand">Smart Banking</div>
        <div>
            <a href="dashboard.html" class="btn" style="background: transparent;">Dashboard</a>
            <button onclick="logout()" class="btn" style="background: #dc3545;">Logout</button>
        </div>
    </nav>

    <div class="container" style="max-width: 600px;">
        <h2 class="section-title">Profile Settings</h2>

        <div class="card">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="full-name" class="form-control">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" class="form-control">
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input type="text" id="phone" class="form-control">
            </div>
            <div class="form-group">
                <label>Profile Image URL</label>
                <input type="text" id="profile-image" class="form-control" placeholder="http://...">
            </div>
            <hr>
            <h3>Change Password</h3>
            <div class="form-group">
                <label>New Password (Leave blank to keep current)</label>
                <input type="password" id="password" class="form-control">
            </div>
            <button onclick="updateProfile()" class="btn" id="save-settings-btn">Save Changes</button>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        if (!isLoggedIn()) window.location.href = 'index.html';

        async function loadProfile() {
            const user = await (await apiCall('/user/profile')).json();
            document.getElementById('full-name').value = user.fullName || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.phoneNumber || '';
            document.getElementById('profile-image').value = user.profileImage || '';
        }

        async function updateProfile() {
            const body = {
                fullName: document.getElementById('full-name').value,
                email: document.getElementById('email').value,
                phoneNumber: document.getElementById('phone').value,
                profileImage: document.getElementById('profile-image').value,
                password: document.getElementById('password').value
            };

            const res = await apiCall('/user/profile', 'PUT', body);
            if (res && res.ok) {
                alert('Profile Updated Successfully');
                // Update local storage user name representation if needed
                const updated = await res.json();
                localStorage.setItem('user', JSON.stringify(updated));
            } else {
                alert('Update Failed');
            }
        }

        loadProfile();
    </script>
</body>

</html>